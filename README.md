# MOEX Trading Bot

Трейд-бот для автоматической торговли акциями на Московской Бирже (MOEX) через API Тинькофф Инвестиций.

## Особенности

- **Автоматизированная торговля** акциями российских компаний
- **Среднесрочные стратегии** с длительностью сделок от одного дня до одной недели
- **Технический анализ** с использованием различных индикаторов (EMA, RSI, MACD, Bollinger Bands)
- **Распознавание свечных паттернов** для повышения точности входа и выхода
- **Управление рисками** с использованием стоп-лоссов, трейлинг-стопов и тейк-профитов
- **Уведомления через Telegram** о сделках и важных событиях
- **Бэктестинг и оптимизация** стратегий на исторических данных

## Требования

- Python 3.7+
- Аккаунт Тинькофф Инвестиций с API-токеном
- Опционально: аккаунт в Telegram для уведомлений

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/username/moex-trading-bot.git
cd moex-trading-bot
```

2. Установите необходимые зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` в корневой директории проекта и добавьте следующие переменные:
```
TINKOFF_TOKEN=your_tinkoff_api_token
TELEGRAM_TOKEN=your_telegram_bot_token  # Опционально
TELEGRAM_CHAT_ID=your_telegram_chat_id  # Опционально
```

4. Настройте параметры в файле конфигурации `config/default_config.yaml` под свои требования.

## Использование

### Запуск бота

```bash
python main.py start
```

Для запуска в фоновом режиме:
```bash
python main.py start --daemon
```

### Остановка бота

```bash
python main.py stop
```

### Проверка статуса

```bash
python main.py status
```

### Генерация отчета о портфеле

```bash
python main.py report
```

### Бэктестинг стратегии

```bash
python main.py backtest --strategy trend --symbol SBER --start-date 2023-01-01 --end-date 2023-12-31
```

### Оптимизация параметров стратегии

```bash
python main.py optimize --strategy trend --symbol SBER
```

## Архитектура проекта

```
trading_bot/
  - __init__.py
  - config/
    - __init__.py
    - config.py          # Класс конфигурации
    - default_config.yaml # Файл с настройками по умолчанию
  - data/
    - __init__.py
    - market_data.py     # Провайдер данных 
    - indicators.py      # Расчет индикаторов
    - patterns.py        # Распознавание свечных паттернов
    - levels.py          # Определение уровней поддержки/сопротивления
  - strategies/
    - __init__.py
    - base.py            # Базовый интерфейс стратегий
    - trend.py           # Трендовая стратегия
    - reversal.py        # Контртрендовая стратегия
    - combined.py        # Комбинированная стратегия
  - execution/
    - __init__.py
    - executor.py        # Исполнение торговых операций
    - risk_manager.py    # Управление рисками
    - position_manager.py # Управление позициями
  - api/
    - __init__.py
    - tinkoff_client.py  # Обертка для Tinkoff API
  - backtest/
    - __init__.py
    - engine.py          # Движок бэктестинга
    - optimizer.py       # Оптимизация параметров
    - metrics.py         # Расчет метрик производительности
  - utils/
    - __init__.py
    - logging.py         # Настройка логирования
    - notifications.py   # Уведомления через Telegram
    - state.py           # Сохранение/загрузка состояния
  - bot.py               # Основной класс бота
  - main.py              # Точка входа
```

## Стратегии

### Трендовая стратегия

Основана на следовании тренду с использованием:
- Пересечения скользящих средних (EMA)
- Подтверждения через MACD
- Подтверждения объемом торгов

### Контртрендовая стратегия

Основана на поиске разворотов на перепроданности/перекупленности рынка:
- RSI для определения перепроданности/перекупленности
- Полосы Боллинджера
- Свечные паттерны для подтверждения разворота
- Уровни поддержки/сопротивления

### Комбинированная стратегия

Объединяет сигналы трендовой и контртрендовой стратегий, адаптируя подход к текущим рыночным условиям.

## Управление рисками

- **Стоп-лосс**: Ограничение убытка (по умолчанию 2.5%)
- **Трейлинг-стоп**: Защита прибыли при достижении уровня (по умолчанию 1.8%)
- **Тейк-профит**: Фиксация прибыли при достижении целевого уровня (по умолчанию 5.0%)
- **Максимальное время удержания**: Автоматическое закрытие позиции после N дней (по умолчанию 7 дней)
- **Ограничение размера позиции**: Контроль максимального размера позиции (по умолчанию 90% от доступного капитала)

## Уведомления

При настроенном Telegram боте, система отправляет уведомления о:
- Запуске/остановке бота
- Открытии/закрытии позиций
- Достижении стоп-лоссов/тейк-профитов
- Ошибках в работе

## Бэктестинг и оптимизация

Система поддерживает:
- Тестирование стратегий на исторических данных
- Оптимизацию параметров методом полного перебора (Grid Search)
- Оптимизацию методом скользящего окна (Walk-Forward)
- Расчет различных метрик эффективности (Sharpe Ratio, Max Drawdown, Win Rate, Profit Factor и др.)

## Лицензия

MIT

## Отказ от ответственности

Данное программное обеспечение предоставляется только в информационных целях. Автор не несет ответственности за любые финансовые потери, связанные с использованием данного бота. Торговля на финансовых рынках сопряжена с высоким риском, и вы должны проводить собственный анализ перед принятием инвестиционных решений.